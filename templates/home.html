<!-- templates/home.html -->
{% extends 'base.html' %}

{% block title %}–ì–ª–∞–≤–Ω–∞—è - Feelings App{% endblock %}

{% block content %}
<div class="container py-4">
    {% if user.is_authenticated %}
        <!-- –ö–û–ù–¢–ï–ù–¢ –î–õ–Ø –ê–í–¢–û–†–ò–ó–û–í–ê–ù–ù–´–• –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô -->
        <div class="row">
            <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
            <div class="col-lg-6 mb-4">
                <div class="card shadow-lg border-0">
                    <div class="card-header bg-gradient-primary text-white">
                        <h4 class="mb-0">‚ú® –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å–≤–æ–∏–º–∏ —á—É–≤—Å—Ç–≤–∞–º–∏</h4>
                    </div>
                    <div class="card-body">
                        <form method="post" id="feelingForm">
                            {% csrf_token %}

                            <!-- –ü–æ–ª–µ –¥–ª—è —Ç–µ–∫—Å—Ç–∞ -->
                            <div class="mb-4">
                                <label for="{{ form.text.id_for_label }}" class="form-label fw-bold">
                                    üí≠ –ß—Ç–æ –≤—ã —á—É–≤—Å—Ç–≤—É–µ—Ç–µ —Å–µ–≥–æ–¥–Ω—è?
                                </label>
                                {{ form.text }}
                                {% if form.text.errors %}
                                <div class="text-danger small mt-1">
                                    {{ form.text.errors }}
                                </div>
                                {% endif %}
                            </div>

                            <!-- –ü–æ–ª–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ —ç–º–æ—Ü–∏–∏ -->
                            <div class="mb-4">
                                <label for="{{ form.emotion.id_for_label }}" class="form-label fw-bold">
                                    üòä –û—Å–Ω–æ–≤–Ω–∞—è —ç–º–æ—Ü–∏—è
                                </label>
                                {{ form.emotion }}
                                {% if form.emotion.errors %}
                                <div class="text-danger small mt-1">
                                    {{ form.emotion.errors }}
                                </div>
                                {% endif %}
                            </div>

                            <!-- –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ -->
                            <div class="d-grid">
                                <button type="submit" class="btn btn-primary btn-lg">
                                    üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –º–æ–∏ —á—É–≤—Å—Ç–≤–∞
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- –ë—ã—Å—Ç—Ä–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                <div class="card shadow-sm border-0 mt-4">
                    <div class="card-header bg-light">
                        <h6 class="mb-0">üìä –í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h6>
                    </div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-6">
                                <div class="text-primary fw-bold fs-4">{{ feelings.count }}</div>
                                <div class="text-muted small">–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π</div>
                            </div>
                            <div class="col-6">
                                <div class="text-success fw-bold fs-4">
                                    {% if feelings.first %}
                                        {{ feelings.first.created_at|timesince }}
                                    {% else %}
                                        0
                                    {% endif %}
                                </div>
                                <div class="text-muted small">–° –ø–æ—Å–ª–µ–¥–Ω–µ–π –∑–∞–ø–∏—Å–∏</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - –°–ø–∏—Å–æ–∫ –∑–∞–ø–∏—Å–µ–π -->
            <div class="col-lg-6">
                <div class="card shadow-lg border-0">
                    <div class="card-header bg-gradient-info text-white">
                        <h4 class="mb-0">üìñ –ò—Å—Ç–æ—Ä–∏—è –≤–∞—à–∏—Ö –∑–∞–ø–∏—Å–µ–π</h4>
                    </div>
                    <div class="card-body">
                        {% if feelings %}
                            <div class="feelings-list">
                                {% for feeling in feelings %}
                                <div class="feeling-item mb-4 p-3 rounded"
                                     style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);">

                                    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∑–∞–ø–∏—Å–∏ -->
                                    <div class="d-flex justify-content-between align-items-start mb-2">
                                        <span class="badge emotion-badge
                                            {% if feeling.emotion == 'happy' %}bg-warning
                                            {% elif feeling.emotion == 'sad' %}bg-secondary
                                            {% elif feeling.emotion == 'angry' %}bg-danger
                                            {% else %}bg-primary{% endif %}">
                                            {% if feeling.emotion == 'happy' %}üòä –°—á–∞—Å—Ç–ª–∏–≤
                                            {% elif feeling.emotion == 'sad' %}üò¢ –ì—Ä—É—Å—Ç–Ω—ã–π
                                            {% elif feeling.emotion == 'angry' %}üò† –ó–ª–æ–π
                                            {% elif feeling.emotion == 'excited' %}ü§© –í–∑–≤–æ–ª–Ω–æ–≤–∞–Ω–Ω—ã–π
                                            {% elif feeling.emotion == 'calm' %}üòå –°–ø–æ–∫–æ–π–Ω—ã–π
                                            {% elif feeling.emotion == 'anxious' %}üò∞ –¢—Ä–µ–≤–æ–∂–Ω—ã–π
                                            {% elif feeling.emotion == 'grateful' %}üôè –ë–ª–∞–≥–æ–¥–∞—Ä–Ω—ã–π
                                            {% elif feeling.emotion == 'tired' %}üò¥ –£—Å—Ç–∞–≤—à–∏–π
                                            {% else %}üòê –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ{% endif %}
                                        </span>
                                        <small class="text-muted">{{ feeling.created_at|date:"d.m.Y H:i" }}</small>
                                    </div>

                                    <!-- –¢–µ–∫—Å—Ç –∑–∞–ø–∏—Å–∏ -->
                                    <p class="mb-3 feeling-text">{{ feeling.text }}</p>

                                    <!-- –î–µ–π—Å—Ç–≤–∏—è -->
                                    <div class="d-flex justify-content-between align-items-center">
                                        <small class="text-muted">
                                            üìÖ {{ feeling.created_at|date:"d M Y" }}
                                        </small>
                                        <form method="post" action="{% url 'delete_feeling' feeling.pk %}"
                                              class="d-inline" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–ø–∏—Å—å?')">
                                            {% csrf_token %}
                                            <button type="submit" class="btn btn-sm btn-outline-danger">
                                                üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                                            </button>
                                        </form>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –∑–∞–ø–∏—Å–µ–π -->
                            <div class="text-center py-5">
                                <div class="empty-state-icon mb-3">üìù</div>
                                <h5 class="text-muted">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π</h5>
                                <p class="text-muted">–ù–∞—á–Ω–∏—Ç–µ –¥–æ–±–∞–≤–ª—è—Ç—å —Å–≤–æ–∏ —á—É–≤—Å—Ç–≤–∞, –∏—Å–ø–æ–ª—å–∑—É—è —Ñ–æ—Ä–º—É —Å–ª–µ–≤–∞</p>
                                <div class="mt-3">
                                    <span class="badge bg-primary me-2">üòä –°—á–∞—Å—Ç–ª–∏–≤</span>
                                    <span class="badge bg-secondary me-2">üò¢ –ì—Ä—É—Å—Ç–Ω—ã–π</span>
                                    <span class="badge bg-success me-2">üòå –°–ø–æ–∫–æ–π–Ω—ã–π</span>
                                    <span class="badge bg-warning">ü§© –í–∑–≤–æ–ª–Ω–æ–≤–∞–Ω–Ω—ã–π</span>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

    {% else %}
        <!-- –ö–û–ù–¢–ï–ù–¢ –î–õ–Ø –ù–ï–ê–í–¢–û–†–ò–ó–û–í–ê–ù–ù–´–• –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô -->
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="text-center mb-5">
                    <h1 class="display-4 gradient-text">üåä Feelings App</h1>
                    <p class="lead text-muted">–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≤–∞—à–∏—Ö —ç–º–æ—Ü–∏–π –∏ —á—É–≤—Å—Ç–≤</p>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <!-- –§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
                        <div class="card shadow">
                            <div class="card-header bg-success text-white">
                                <h4 class="mb-0">üöÄ –ë—ã—Å—Ç—Ä–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h4>
                            </div>
                            <div class="card-body">
                                <form method="post">
                                    {% csrf_token %}

                                    <div class="mb-3">
                                        <label for="username" class="form-label">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                                        <input type="text" class="form-control" id="username" name="username"
                                               placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" required>
                                    </div>

                                    <div class="mb-3">
                                        <label for="email" class="form-label">Email</label>
                                        <input type="email" class="form-control" id="email" name="email"
                                               placeholder="–í–∞—à email" required>
                                    </div>

                                    <div class="mb-3">
                                        <label for="password1" class="form-label">–ü–∞—Ä–æ–ª—å</label>
                                        <input type="password" class="form-control" id="password1" name="password1"
                                               placeholder="–°–æ–∑–¥–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å" required>
                                    </div>

                                    <div class="mb-3">
                                        <label for="password2" class="form-label">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è</label>
                                        <input type="password" class="form-control" id="password2" name="password2"
                                               placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required>
                                    </div>

                                    <button type="submit" class="btn btn-success w-100">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
                                </form>

                                <!-- –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö -->
                                {% if form.errors %}
                                <div class="alert alert-danger mt-3">
                                    <strong>–û—à–∏–±–∫–∏:</strong>
                                    <ul class="mb-0">
                                        {% for field in form %}
                                            {% for error in field.errors %}
                                                <li>{{ error }}</li>
                                            {% endfor %}
                                        {% endfor %}
                                        {% for error in form.non_field_errors %}
                                            <li>{{ error }}</li>
                                        {% endfor %}
                                    </ul>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                        <div class="card shadow h-100">
                            <div class="card-header bg-primary text-white">
                                <h4 class="mb-0">üí´ –ü–æ—á–µ–º—É —Å—Ç–æ–∏—Ç –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è?</h4>
                            </div>
                            <div class="card-body">
                                <div class="mb-4">
                                    <h6>üåà –û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ —ç–º–æ—Ü–∏–∏</h6>
                                    <p class="text-muted">–ó–∞–ø–∏—Å—ã–≤–∞–π—Ç–µ —Å–≤–æ–∏ —á—É–≤—Å—Ç–≤–∞ –∏ –Ω–∞–±–ª—é–¥–∞–π—Ç–µ –∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è</p>
                                </div>

                                <div class="mb-4">
                                    <h6>üìä –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Ç–µ–Ω–¥–µ–Ω—Ü–∏–∏</h6>
                                    <p class="text-muted">–ù–∞–π–¥–∏—Ç–µ –∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç–∏ –≤ —Å–≤–æ–∏—Ö —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏—è—Ö</p>
                                </div>

                                <div class="mb-4">
                                    <h6>üîí –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å</h6>
                                    <p class="text-muted">–í–∞—à–∏ –∑–∞–ø–∏—Å–∏ –≤–∏–¥–Ω—ã —Ç–æ–ª—å–∫–æ –≤–∞–º</p>
                                </div>

                                <hr>

                                <!-- –°—Å—ã–ª–∫–∞ –Ω–∞ –≤—Ö–æ–¥ –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
                                <div class="text-center">
                                    <p class="mb-2">–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç?</p>
                                    <a href="{% url 'login' %}" class="btn btn-outline-primary w-100">–í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
</div>

<style>
    /* –°—Ç–∏–ª–∏ –¥–ª—è –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
    .gradient-text {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .bg-gradient-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
    }

    .bg-gradient-info {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%) !important;
    }

    .card {
        border-radius: 20px;
        overflow: hidden;
    }

    .feeling-item {
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        border: 1px solid rgba(0,0,0,0.05);
    }

    .feeling-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.1);
    }

    .emotion-badge {
        font-size: 0.8rem;
        padding: 0.5em 1em;
        border-radius: 20px;
    }

    .feeling-text {
        line-height: 1.6;
        color: #495057;
        font-size: 1rem;
    }

    .empty-state-icon {
        font-size: 4rem;
        opacity: 0.5;
    }

    .form-control {
        border-radius: 12px;
        padding: 12px 15px;
        border: 2px solid #e9ecef;
        transition: all 0.3s ease;
    }

    .form-control:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
    }

    textarea.form-control {
        min-height: 120px;
        resize: vertical;
    }

    .btn {
        border-radius: 12px;
        padding: 12px 30px;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0,0,0,0.15);
    }

    .btn-lg {
        padding: 15px 30px;
        font-size: 1.1rem;
    }
</style>

<script>
    // JavaScript –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è UX
    document.addEventListener('DOMContentLoaded', function() {
        // –ê–≤—Ç–æ—Ñ–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ —Ç–µ–∫—Å—Ç–∞
        const textArea = document.querySelector('textarea[name="text"]');
        if (textArea) {
            textArea.focus();
        }

        // –ü–æ–¥—Å—á–µ—Ç —Å–∏–º–≤–æ–ª–æ–≤
        const charCounter = document.createElement('div');
        charCounter.className = 'text-muted small mt-1 text-end';
        if (textArea) {
            textArea.parentNode.appendChild(charCounter);

            textArea.addEventListener('input', function() {
                const length = this.value.length;
                charCounter.textContent = `${length} —Å–∏–º–≤–æ–ª–æ–≤`;

                if (length > 500) {
                    charCounter.className = 'text-danger small mt-1 text-end';
                } else if (length > 300) {
                    charCounter.className = 'text-warning small mt-1 text-end';
                } else {
                    charCounter.className = 'text-muted small mt-1 text-end';
                }
            });
        }
    });

    // –ê–Ω–∏–º–∞—Ü–∏—è –ø—É–ª—å—Å–∞—Ü–∏–∏ –¥–ª—è –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π
    const style = document.createElement('style');
    style.textContent = `
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(102, 126, 234, 0); }
            100% { box-shadow: 0 0 0 0 rgba(102, 126, 234, 0); }
        }
    `;
    document.head.appendChild(style);
</script>
{% endblock %}